<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <link rel="stylesheet" href="/main.css">
    <link rel="stylesheet" href="https://fonts.googleapis.com/css2?family=Open+Dyslexic&display=swap">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css">
    <title>Fitness Tracker - Login</title>
</head>
<body class="<%= theme %> <%= fontPref %>">

<!-- Flash Messages -->
<% if (messages.success) { %>
    <div class="flash success"><%= messages.success %></div>
<% } %>
<% if (messages.error) { %>
    <div class="flash error"><%= messages.error %></div>
<% } %>

<!-- Navbar -->
<nav>
    <div class="hamburger" onclick="toggleMenu()">
        <span></span>
        <span></span>
        <span></span>
    </div>
    
    <ul>
        <li><a href="/" class="nav-link">Home</a></li>
        <li><a href="/dashboard" class="nav-link">Dashboard</a></li>

        <!-- Fitness Dropdown Button -->
        <li class="dropdown">
            <a href="javascript:void(0)" class="dropbtn" onclick="toggleDropdown()">Fitness</a>
            <div class="dropdown-content">
                <a href="/workout" class="dropdown-item">Generate Workout</a>
                <a href="/water" class="dropdown-item">Water Tracker</a>
                <a href="/sleep" class="dropdown-item">Sleep Tracker</a>
            </div>
        </li>

        <li><a href="/faq" class="nav-link">FAQ and Feedback</a></li>
        <li><a href="/settings" class="nav-link">Settings</a></li>

        <!-- User Icon -->
        <% if (user) { %>
            <li class="user-icon">
                <a href="/profile">
                    <span><%= user.username %></span>
                    <img src="/<%= user.profileIcon || 'avatarblack.png' %>" alt="User Icon" />
                </a>
            </li>
        <% } else { %>
            <li><a href="/users/login" class="nav-link active">Login</a></li>
            <li><a href="/users/register" class="nav-link">Sign Up</a></li>
        <% } %>
    </ul>
</nav>

<div class="login-container">
    <div class="login-card">
        <div class="card-header">
            <i class="fas fa-user-circle"></i>
            <h1>Welcome Back</h1>
            <p class="subtitle">Log in to continue your fitness journey</p>
        </div>

        <form id="loginForm" action="/users/login" method="POST" class="login-form">
            <div class="form-group">
                <label for="email">
                    <i class="fas fa-envelope"></i>
                    Email Address
                </label>
                <input 
                    type="email" 
                    id="email" 
                    name="email" 
                    required 
                    placeholder="Enter your email"
                    autocomplete="email"
                >
                <small class="error"></small>
            </div>

            <div class="form-group">
                <label for="password">
                    <i class="fas fa-lock"></i>
                    Password
                </label>
                <div class="password-input-group">
                    <input 
                        type="password" 
                        id="password" 
                        name="password" 
                        required 
                        placeholder="Enter your password"
                        autocomplete="current-password"
                    >
                    <button type="button" class="toggle-password" onclick="togglePasswordVisibility()">
                        <i class="fas fa-eye"></i>
                    </button>
                </div>
                <small class="error"></small>
            </div>

            <div class="form-options">
                <label class="remember-me">
                    <input type="checkbox" name="remember" id="remember">
                    <span>Remember me</span>
                </label>
                <a href="/users/forgot-password" class="forgot-password">Forgot Password?</a>
            </div>

            <button type="submit" class="login-button">
                <i class="fas fa-sign-in-alt"></i>
                Log In
            </button>

            <% if (message) { %>
                <div class="form-message error">
                    <i class="fas fa-exclamation-circle"></i>
                    <%= message %>
                </div>
            <% } %>
        </form>

        <div class="card-footer">
            <p>Don't have an account? <a href="/users/register">Sign up now</a></p>
        </div>
    </div>
</div>

<script>
    function toggleDropdown() {
        var dropdown = document.querySelector('.dropdown');
        dropdown.classList.toggle('active');
    }

    function toggleMenu() {
        const navList = document.querySelector('nav ul');
        navList.classList.toggle('active');
    }

    function togglePasswordVisibility() {
        const passwordInput = document.getElementById('password');
        const toggleButton = document.querySelector('.toggle-password i');
        
        if (passwordInput.type === 'password') {
            passwordInput.type = 'text';
            toggleButton.classList.replace('fa-eye', 'fa-eye-slash');
        } else {
            passwordInput.type = 'password';
            toggleButton.classList.replace('fa-eye-slash', 'fa-eye');
        }
    }

    document.getElementById('loginForm').addEventListener('submit', function(e) {
        const email = document.getElementById('email');
        const password = document.getElementById('password');
        let isValid = true;

        // Clear previous errors
        document.querySelectorAll('.error').forEach(error => error.textContent = '');

        // Email validation
        if (!email.value.trim()) {
            email.nextElementSibling.textContent = 'Email is required';
            isValid = false;
        } else if (!isValidEmail(email.value.trim())) {
            email.nextElementSibling.textContent = 'Please enter a valid email address';
            isValid = false;
        }

        // Password validation
        if (!password.value.trim()) {
            password.parentElement.nextElementSibling.textContent = 'Password is required';
            isValid = false;
        }

        if (!isValid) e.preventDefault();
    });

    function isValidEmail(email) {
        return /^[^\s@]+@[^\s@]+\.[^\s@]+$/.test(email);
    }
</script>

</body>
</html>
